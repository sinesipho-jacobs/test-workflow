name: Reusable Test Workflow

on:
  workflow_call:

jobs:
  run-tests:
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“¥ Checkout Repository"
        uses: actions/checkout@v4

      - name: "ğŸ Set up Python"
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: "ğŸ“œ Install Robot Framework"
        run: pip install robotframework

      - name: "ğŸ“‚ Create test results directory"
        run: mkdir -p webapp_tests/robot-test-results

      - name: "ğŸ› ï¸ Run Robot Framework Tests"
        run: |
          robot --output webapp_tests/robot-test-results/output.xml webapp_tests/tests

      - name: "ğŸ“¤ Upload test results"
        uses: actions/upload-artifact@v4
        with:
          name: robot-test-results
          path: webapp_tests/robot-test-results/output.xml

  parse-results:
    runs-on: ubuntu-latest
    needs: run-tests
    steps:
      - name: "ğŸ“¥ Checkout Repository"
        uses: actions/checkout@v4

      - name: "ğŸ“¥ Download Test Results"
        uses: actions/download-artifact@v4
        with:
          name: robot-test-results
          path: webapp_tests/robot-test-results

      - name: "ğŸ“œ Install Python Dependencies"
        run: pip install robotframework

      - name: "ğŸ“ Parse Test Results"
        run: python functions/display_test_results.py webapp_tests/robot-test-results/output.xml parsed_report.md

      - name: "ğŸ“Œ Display Test Summary"
        run: cat parsed_report.md
