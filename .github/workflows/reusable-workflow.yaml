name: Reusable Test Workflow

on:
  workflow_call:

jobs:
  run-tests:
    runs-on: ubuntu-latest
    steps:
      - name: "📥 Checkout Repository"
        uses: actions/checkout@v4

      - name: "🐍 Set up Python"
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: "📜 Install Robot Framework"
        run: pip install robotframework

      - name: "📂 Create test results directory"
        run: mkdir -p webapp_tests/robot-test-results

      - name: "🛠️ Run Robot Framework Tests"
        run: |
          robot --output webapp_tests/robot-test-results/output.xml webapp_tests/tests

      - name: "📤 Upload test results"
        uses: actions/upload-artifact@v4
        with:
          name: robot-test-results
          path: webapp_tests/robot-test-results/output.xml

  parse-results:
    runs-on: ubuntu-latest
    needs: run-tests
    steps:
      - name: "📥 Checkout Repository"
        uses: actions/checkout@v4

      - name: "📥 Download Test Results"
        uses: actions/download-artifact@v4
        with:
          name: robot-test-results
          path: webapp_tests/robot-test-results

      - name: "📜 Install Python Dependencies"
        run: pip install robotframework

      - name: "📝 Parse Test Results"
        run: python functions/display_test_results.py webapp_tests/robot-test-results/output.xml parsed_report.md

      - name: "📌 Display Test Summary"
        run: cat parsed_report.md
